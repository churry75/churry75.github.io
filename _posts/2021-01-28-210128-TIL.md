---
title: "2021.01.28 TIL"
excerpt: "월간 프로젝트 D-1. 차선인식 모의 자율주행"
toc: true
toc_sticky: true

categories:
    - TIL 
tags:
    - TIL
    - 자율주행 스쿨
    - ROS
    - OpenCV

last_modified_at: 2021.01.28-13:27:26  
---
 
# 2021-01-28 TIL📓
## 오늘 할 일
- [x] 월간 프로젝트 대비 실습 겸 오프라인 강의

## 월간 자율주행 프로젝트 D-1
### 수행 내용
- 어제 집에서 수정한 코드 적용하여 테스트 주행
    - 곡선은 잘 통과가 되지만, 주행 시 차선의 중앙을 유지하지 못 함
    - NonType 에러가 계속 발생
    - 조향각 계산 수정
        > 적절한 보정 값을 찾는 것이 관건
- NonType 에러에 대한 예외 처리 수정
    - 차선을 못 찾을 경우, 코드 상 else 문을 돌게 될 때, 직전의 기울기 값으로 토픽을 발행하도록 적용함
- 차선 오인식 문제
    - 기울기 값의 임계값을 조건으로 일정 범위의 기울기만을 사용하도록 하며,
    - 이를 return 으로 반환해 한 가지 확실한 선만을 받아 올 수 있도록 함
    - 그러나, 여전히 튀는 값들이 발생하게 되며, return 된 선이 확실한 선이라는 보장이 없음
- 허프 변환으로 인식한 차선에 대한 누계값 적용
    - 이전에 기울기의 절대값 한 개만 받아오던 것을 왼쪽, 오른쪽으로 나눔
    - 빈 리스트에 각각 저장
    - 기울기의 임계값 범위를 지정해 주어, 범위를 벗어나는 선은 저장하지 않음
    - 토픽을 발행하기 전까지 쌓인 기울기(각도) 값이 발행에 사용될 때 평균값으로 사용이 되게 하였고, 이때의 좌표 정보도 같이 보내
    - 저장되는 기울기(각도)는 Try&Error로 설정함(노가다임)
- 차선 중앙 유지
    - 명도차 기반으로 할 때 테스트 했던 방식으로,\
    카메라의 중심(320 point)를 기준으로 양 끝 차선의 포인트가 오른 쪽에 있으면(즉, 차가 왼쪽 차선에 붙게 되면), 반대로 갈 수 있게 조향 설정
    - 320 point와 인식된 차선의 중앙값의 차이에 일정 가중치를 주어 조향각으로 설정함

### 결과
- 놀랄만한 일이 발생함
- 중앙 유지만을 위해 작성한 코드를 일단 모든 경우를 보기 위해 별다른 조정(?) 없이 테스트 주행을 했는데,\
코스를 이탈하지 않고 완주했음😬
- 속도를 xycar에서 사용된 vecs 모터 컨트롤러의 tutorial 모드에서 50으로 설정했을 때도 이상없이 주행함(속도에 따른 조향각 가중치는 조절해주어야 함)

### 문제점이라기 보다는 개선점
- 아무래도 원래 계획대로 하기 전에 주행이 되버리니 더 건드리면 안될 것 같지만...!
- 처음 의도 대로,
    1. 직진 or 완만한 곡선 주행 일 때만 픽셀차에 의한 조향 조절
        - 이 작업은 온전히 차선 중앙 유지만을 위해 동작하도록 설정!
    2. 곡선 주행일 때 인식된 차선의 기울기에 맞춰서 각도가 smooth하게 조절이 되도록 개선 예정
    3. 추가로 곡선일 때는 완만한 주행을 의해 감속하고, 직진일 때는 랩 타임 레코드를 위해 가속할 수 있도록 추가 작업
    4. 또한, 속도에 따라 조향각의 가중치도 달라지기 때문에, 이에 대해 적절한 값을 찾아야함
        > 우리의 차는 오히려 속도가 너무 낮으면, 주행이 잘 안되는 경향이 있는데\
        > 차선 인식에 대한 문제일까? 아니면 조향각에 대한 문제일까? 아무래도 후자일 것 같은 느낌이 강력하게 듦

## 잡담...
오늘은 그래도 기분 좋은 마무리를 했다.
비록 슬라이딩 윈도우까지는 건드려보지 못 했지만, 무사고 완주에 대한 목표는 달성했다(기록에 욕심이 없다면...)
실습을 하다 보니 너무 재밌다.
마당 딸린 집에 트랙 설치하고 이런 작업하면서 하루 종일 놀고 싶다😎
기분 좋은 스트레스다.

## 장기계획
- 코딩테스트 대비 **코드 스니펫** 만들기
- vim과 친해지기 위해 **plugin**을 적극 활용할 수 있도록 공부하고, 나만의 **.vimrc** 만들기
    - 일단 제일 먼저 autopep8 플러그인 설치
    - pep8에 위배되는 문법을 내 코드에서 찾아서 하이라이팅 해주는 플러그인이 있다고 하는데 찾아서 설치하자!
- 💫 밀린 강의노트 정리
