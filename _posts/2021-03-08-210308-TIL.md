---
title: "2021.03.08 TIL"
excerpt: "Cuda ì„¤ì¹˜ & Docker"
toc: true
toc_sticky: true

categories:
    - TIL 
tags:
    - TIL
    - ììœ¨ì£¼í–‰ ìŠ¤ì¿¨
    - CUDA
    - Docker

last_modified_at: 2021.03.08-15:58:39   
---
 
# 2021-03-08 TILğŸ““
## ì˜¤ëŠ˜ í•  ì¼
- [x] ubuntu 18.04 desktopì— cudaì™€ cudnn ì„¤ì¹˜
- [x] docker ì„¤ì¹˜ ë° ê¸°ë³¸ ì‚¬ìš©ë²• ìµíˆê¸°
- [x] Carla Simulator ì„¤ì¹˜

## CUDA / cuDNN ì„¤ì¹˜
- NVIDIA ê³µì‹ ì‚¬ì´íŠ¸ ì°¸ê³ 
    1. CUDA ì„¤ì¹˜
        - ê°•ì˜ í™˜ê²½ê³¼ ë§ì¶”ê¸° ìœ„í•´ 10.0 ver ì„¤ì¹˜
            - [ê³µì‹ ì‚¬ì´íŠ¸](https://developer.nvidia.com/cuda-10.0-download-archive)
        - ìœ„ì˜ ì£¼ì†Œë¡œ ë“¤ì–´ê°€ì„œ ìˆœì„œëŒ€ë¡œ ë”°ë¼í•˜ë©´ ì •ìƒì ìœ¼ë¡œ ì„¤ì¹˜ë¨
    2. cuDNN ì„¤ì¹˜
        - ê°•ì˜ í™˜ê²½ê³¼ ë§ì¶”ê¸° ìœ„í•´ libcudnn7 ver. ì„¤ì¹˜
            - [ê³µì‹ ì‚¬ì´íŠ¸](https://docs.nvidia.com/deeplearning/cudnn/install-guide/index.html)
        - ê³µì‹ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì—¬ ì„¤ì¹˜í•˜ëŠ” ê²ƒì´ ê°€ì¥ ì‰½ê³  ë¹ ë¥´ê²Œ ì„¤ì¹˜í•  ìˆ˜ ìˆìŒ
        - ìœ„ì˜ ì£¼ì†Œì— cudnnì„ ë‹¤ìš´ ë°›ì„ ìˆ˜ ìˆëŠ” ì£¼ì†Œê°€ ì•ˆë‚´ë˜ì–´ ìˆìœ¼ë‹ˆ í•´ë‹¹ ì‚¬ì´íŠ¸ì—ì„œ ì›í•˜ëŠ” ë²„ì „ìœ¼ë¡œ cudnnì„ ë‹¤ìš´ ë°›ì„ ê²ƒ
        - ê³µì‹ ë¬¸ì„œì—ëŠ” ìµœì‹ ë²„ì „ì¸ libcudnn8ë¡œ ê¸°ì¬ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ì´ê²ƒë§Œ ì£¼ì˜ í•  ê²ƒ

## Docker
### Docker ì„¤ì¹˜
- [ê³µì‹ ì‚¬ì´íŠ¸](https://docs.docker.com/engine/install/ubuntu/)
- ê³µì‹ ì‚¬ì´íŠ¸ì˜ ì„¤ì¹˜ ë°©ë²•ëŒ€ë¡œ ì„¤ì¹˜

### Dockerë¥¼ ìœ„í•œ NVIDIA gpu ì‚¬ìš© í™˜ê²½ ì„¤ì •
- [ì°¸ê³  ì‚¬ì´íŠ¸](https://cnvrg.io/how-to-setup-docker-and-nvidia-docker-2-0-on-ubuntu-18-04/)
- ì°¸ê³  ì‚¬ì´íŠ¸ë¥¼ ì°¸ê³ í•˜ì—¬ í™˜ê²½ ì„¤ì • ìˆ˜í–‰

### Docker ì‚¬ìš©ë°©ë²•
- vmware vs docker
    - dockerëŠ” vmwareì™€ ë‹¬ë¦¬ ì“°ë˜ ì»¤ë„ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆìŒ
    - ìœ ì € í™˜ê²½(os)ë§Œ ë°”ê¿”ì„œ ë°”ë¡œë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
    - vmwareì™€ ë‹¬ë¦¬ ì»¤ë„ë§Œ ë°”ê¿”ì„œ ì“°ê¸° ë•Œë¬¸ì— ê°€ë³ê³  ê°„í¸í•¨
- [Docker hub](https://hub.docker.com/)ì—ì„œ ë‹¤ì–‘í•œ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ ë°›ì„ ìˆ˜ ìˆìŒ
- `$ docker images` ëª…ë ¹ìœ¼ë¡œ ì„¤ì¹˜ëœ ì´ë¯¸ì§€ë¥¼ í™•ì¸ í•  ìˆ˜ ìˆìŒ\
![image](/assets/images/lecture/week15_imgs/210308_01.png)

- ë‹¤ìš´ ë°›ì€ ì´ë¯¸ì§€ë¥¼ Containerì— ì˜¬ë¦¬ëŠ” ë°©ë²•
    - `$ docker run -it --name ch ros:kinetic-ros-core-xenial`
    - chëŠ” ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ ì§€ì •í•´ì£¼ê³  ì‹¶ì€ëŒ€ë¡œ ì§€ì •í•˜ë©´ ëœë‹¤.\
        `$ docker run -it --name <ì‚¬ìš©ì ì´ë¦„> <image>`
    
- containerì—ì„œ ë‚˜ì˜¤ê¸°
    - `^D` or `$ exit`
    - dockerê°€ ì¢…ë£Œë˜ëŠ” ê²ƒì€ ì•„ë‹ˆë¯€ë¡œ, runì„ í•´ì„œ ë‹¤ì‹œ ë™ì‘í•˜ë©´ ì´ë¯¸ ì‚¬ìš© ì¤‘ì´ë¼ê³  ì—ëŸ¬ê°€ ëœ¬ë‹¤.

- í˜„ì¬ ì‹¤í–‰ì¤‘ì¸ container í™•ì¸
    - `$ docker container ls <option>`\
![image](/assets/images/lecture/week15_imgs/210308_02.png)
    - `-a` optionì„ ë¶™ì´ë©´ ë‚˜ê°€ì ¸ ìˆëŠ” containerë„ í™•ì¸ ê°€ëŠ¥

- ë‚˜ê°„ containerì— ë‹¤ì‹œ ë“¤ì–´ê°€ê¸°
    1. `$ docker start <ì‚¬ìš©ì ì´ë¦„>`
    2. `$ docker attach <ì‚¬ìš©ì ì´ë¦„>`\
![image](/assets/images/lecture/week15_imgs/210308_03.png)

- ë™ì¼í•œ ì´ë¯¸ì§€ë¥¼ containerë¥¼ ì—¬ëŸ¬ ê°œ ì‚¬ìš©í•˜ê¸°
    1. ì¼ë°˜ì ìœ¼ë¡œ `run`ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ containerì— ì˜¬ë¦¬ë©´ í•œ ê°œì˜ í„°ë¯¸ë„ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥ í•˜ë‹¤.
    2. ì´ë¯¸ì§€ start í›„ì— `exec` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ ì—¬ëŸ¬ ê°œì˜ í„°ë¯¸ë„ì—ì„œ ë˜‘ê°™ì€ ì´ë¯¸ì§€ì˜ containerë¥¼ ì—´ì–´ ë™ì‹œ ë‹¤ë°œì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥ í•˜ë‹¤.
        - `$ docker exec -it ch /bin/bash`\
![image](/assets/images/lecture/week15_imgs/210308_04.png)

- ì‹¤í–‰ ì¤‘ì¸ contation ë©ˆì¶”ê¸°
    `$ docker stop <ì‹¤í–‰ì¤‘ì¸ container id>`

- container ì‚­ì œ
    - `$ docker rm <ì‚¬ìš©ì ì´ë¦„>`\
![image](/assets/images/lecture/week15_imgs/210308_05.png)
:x
:x
- image ì‚­ì œ
    - `$ docker rmi <image id>`\
![image](/assets/images/lecture/week15_imgs/210308_06.png)

### Dockerì—ì„œ gui ì•±ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•
1. ë¨¼ì €, hostì˜ uidê°€ 1000ë²ˆ ì¸ì§€ í™•ì¸í•´ì•¼ í•¨\
![image](/assets/images/lecture/week15_imgs/210308_07.png)

2. container ì‹¤í–‰

3. rosëŠ” root ê³„ì •ì—ì„œ ì‹¤í–‰ì„ ì˜ ì•ˆí•˜ë¯€ë¡œ ì‚¬ìš©ì ì•„ì´ë”” ìƒì„± í•„ìš”\
![image](/assets/images/lecture/week15_imgs/210308_08.png)
    - ì‚¬ìš©ì ì•„ì´ë”” ìƒì„± í›„ ê´€ë¦¬ì ê¶Œí•œ ë¶€ì—¬\
![image](/assets/images/lecture/week15_imgs/210308_09.png)
    - ì‚¬ìš© í™˜ê²½ ì„¤ì • ... í›„ ì´ë¯¸ì§€ë¡œ ë§Œë“¤ê¸°
        - ë‚´ ì·¨í–¥ëŒ€ë¡œ ë§Œë“  ì„¤ì •ì„ ì´ë¯¸ì§€ë¡œ ë§Œë“¤ì–´ ë‹¤ë¥¸ ê³³ì— ë°°í¬í•  ìˆ˜ ìˆìŒ
![image](/assets/images/lecture/week15_imgs/210308_10.png)

4. gui app ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ container ì‹¤í–‰
    - `$ docker run -it --name <ì‚¬ìš©ì ì´ë¦„> -e DISPLAY=$DISPLAY -v /tmp/.X11-unix:/tmp/.X11-unix:rw <ì´ë¯¸ì§€>`

5. gui í…ŒìŠ¤íŠ¸
    - gui í™˜ê²½ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³¼ ìˆ˜ ìˆëŠ” app ì„¤ì¹˜
        - `$ apt-get install x11-apps`
    - `$ xclock` ì‹¤í–‰(ì‚¬ìš©ì ê³„ì •ì—ì„œ ì‹¤í–‰í•´ì•¼í•¨)
![image](/assets/images/lecture/week15_imgs/210308_11.png)
    > docker ë‚´ì˜ ì‚¬ìš©ì ê³„ì •ì˜ uidê°€ hostì˜ uidì¸ 1000 ë²ˆê³¼ ê°™ì•„ì•¼ ì˜¤ë¥˜ê°€ ë°œìƒì•ˆí•˜ê³  xìœˆë„ìš°ê°€ ì˜ ì‹¤í–‰ëœë‹¤.

6. nvidia-docker ì‚¬ìš©
    - `$ docker run -it --name <ì‚¬ìš©ì ì´ë¦„> -e DISPLAY=$DISPLAY --gpus all --runtime=nvidia -v /tmp/.X11-unix:/tmp/.X11-unix:rw <ì´ë¯¸ì§€>`
![image](/assets/images/lecture/week15_imgs/210308_12.png)

## Carla simulator install on linux
- Carlaì—ì„œ ì œê³µí•˜ëŠ” linux build tutorial\
[![ë™ì˜ìƒ](https://img.youtube.com/vi/iqehmN4V6vI/0.jpg)](https://youtu.be/iqehmN4V6vI)

- [ê³µì‹ ë¬¸ì„œ](https://carla.readthedocs.io/en/latest/build_linux/) ì°¸ê³ í•˜ì—¬ ì„¤ì¹˜ ì§„í–‰

## ì¥ê¸°ê³„íš
- ì½”ë”©í…ŒìŠ¤íŠ¸ ëŒ€ë¹„ **ì½”ë“œ ìŠ¤ë‹ˆí«** ë§Œë“¤ê¸°
